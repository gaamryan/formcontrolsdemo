<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controls Library (WCAG 2.2 Compliant)</title>
    <style>
        /* Basic Reset & Variables */
        :root {
            --primary-color: #005fcc;
            --primary-hover-color: #004a9f;
            /* Light Theme Text/Element Colors */
            --text-color-light: #333;
            --border-color-light: #ccc;
            --label-color-light: #555;
            --input-bg-color-light: #fff;
            --input-border-color-light: #ccc;
            --disabled-bg-color-light: #eee;
            --disabled-text-color-light: #999;
            --form-item-bg-light: transparent;
            --header-bg-light: #f8f9fa;
            --pre-bg-light: #f0f0f0;
            --pre-border-light: #ccc;
            --theme-toggle-bg-light: #fff;
            --component-bg-light: #fff;
            --component-border-light: #ccc;
            --alert-info-bg-light: #e7f3fe;
            --alert-info-border-light: #b3d7f9;
            --alert-info-text-light: #0a58ca;
            --overlay-bg-light: rgba(0, 0, 0, 0.6);


            /* Dark Theme Text/Element Colors */
            --primary-color-dark: #4dabf7;
            --primary-hover-color-dark: #74c0fc;
            --text-color-dark: #eee;
            --border-color-dark: #4a4a4a;
            --label-color-dark: #bbb;
            --input-bg-color-dark: #1a1a1a;
            --input-border-color-dark: #4a4a4a;
            --disabled-bg-color-dark: #333;
            --disabled-text-color-dark: #777;
            --form-item-bg-dark: transparent;
            --header-bg-dark: #1c1f23;
            --pre-bg-dark: #151515;
            --pre-border-dark: #333;
            --theme-toggle-bg-dark: #2a2a2a;
            --component-bg-dark: #252525;
            --component-border-dark: #4a4a4a;
            --alert-info-bg-dark: #1c2a3b;
            --alert-info-border-dark: #2a4a6f;
            --alert-info-text-dark: #a6cfff;
            --overlay-bg-dark: rgba(0, 0, 0, 0.7);


            --error-color: #d9534f;
            --focus-outline-color: #005fcc;
            --input-focus-border-color: #005fcc;
            --focus-outline-color-dark: #4dabf7;
            --input-focus-border-color-dark: #4dabf7;

            --font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            --spacing-unit: 8px;
            --min-control-height: 44px;
        }

        /* Apply base variables (Light theme default) */
        :root {
            --text-color: var(--text-color-light);
            --border-color: var(--border-color-light);
            --label-color: var(--label-color-light);
            --input-bg-color: var(--input-bg-color-light);
            --input-border-color: var(--input-border-color-light);
            --disabled-bg-color: var(--disabled-bg-color-light);
            --disabled-text-color: var(--disabled-text-color-light);
            --form-item-bg: var(--form-item-bg-light);
            --header-bg: var(--header-bg-light);
            --pre-bg: var(--pre-bg-light);
            --pre-border: var(--pre-border-light);
            --theme-toggle-bg: var(--theme-toggle-bg-light);
            --component-bg: var(--component-bg-light);
            --component-border: var(--component-border-light);
            --alert-info-bg: var(--alert-info-bg-light);
            --alert-info-border: var(--alert-info-border-light);
            --alert-info-text: var(--alert-info-text-light);
            --overlay-bg: var(--overlay-bg-light);
        }


        /* Dark Theme Overrides */
        body.dark-theme {
             --primary-color: var(--primary-color-dark);
            --primary-hover-color: var(--primary-hover-color-dark);
            --text-color: var(--text-color-dark);
            --border-color: var(--border-color-dark);
            --label-color: var(--label-color-dark);
            --input-bg-color: var(--input-bg-color-dark);
            --input-border-color: var(--input-border-color-dark);
            --disabled-bg-color: var(--disabled-bg-color-dark);
            --disabled-text-color: var(--disabled-text-color-dark);
            --form-item-bg: var(--form-item-bg-dark);
            --header-bg: var(--header-bg-dark);
            --pre-bg: var(--pre-bg-dark);
            --pre-border: var(--pre-border-dark);
            --theme-toggle-bg: var(--theme-toggle-bg-dark);
            --component-bg: var(--component-bg-dark);
            --component-border: var(--component-border-dark);
            --alert-info-bg: var(--alert-info-bg-dark);
            --alert-info-border: var(--alert-info-border-dark);
            --alert-info-text: var(--alert-info-text-dark);
            --overlay-bg: var(--overlay-bg-dark);


            --error-color: #f78b88;
            --focus-outline-color: var(--focus-outline-color-dark);
            --input-focus-border-color: var(--input-focus-border-color-dark);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            height: 100%;
        }

        body {
            font-family: var(--font-family);
            color: var(--text-color);
            background-color: #f5f5f5;
            background-image: linear-gradient(147deg, #f5f5f5 0%, #fffafa 74%);
            background-attachment: fixed;
            background-size: cover;
            min-height: 100%;
            line-height: 1.6;
            padding: 0 0 3rem 0;
            padding-top: 190px;
            transition: color 0.3s ease;
        }
        body.modal-open {
             overflow: hidden;
        }

        body.dark-theme {
            background-color: #003153;
            background-image: linear-gradient(315deg, #003153 0%, #1B1B1B 74%);
        }


        /* --- Theme Toggle (Inside Header) --- */
        .theme-toggle-container {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) / 2);
            background: var(--theme-toggle-bg);
            padding: calc(var(--spacing-unit) / 2);
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease;
        }
        body.dark-theme .theme-toggle-container {
             box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .theme-toggle-container label {
             font-size: 0.9em;
             font-weight: normal;
             color: var(--label-color);
             margin-bottom: 0;
        }

        h1, h2, h3 {
            margin-bottom: calc(var(--spacing-unit) * 2);
            color: var(--primary-color);
        }
        h1 {
            margin-top: 0;
            margin-bottom: 0;
        }
        h2 { margin-top: calc(var(--spacing-unit) * 4); }
        h3 { margin-top: calc(var(--spacing-unit) * 3); }

        p, ol {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        ul {
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding-left: 1rem;
        }
        .accessibility-notes ul {
             padding-left: 0;
             list-style: none;
        }
         .accessibility-notes ul ul {
              padding-left: 1rem;
              list-style: disc;
              margin-top: calc(var(--spacing-unit) / 2);
         }
         .accessibility-notes li {
             margin-bottom: calc(var(--spacing-unit) / 2);
         }


        pre {
            background-color: var(--pre-bg);
            padding: calc(var(--spacing-unit) * 2);
            border-radius: 4px;
            overflow-x: auto;
            margin-top: var(--spacing-unit);
            margin-bottom: var(--spacing-unit);
            border: 0px solid var(--pre-border);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        code {
            font-family: monospace;
             color: var(--text-color);
        }
        body.dark-theme pre code {
            color: var(--text-color-dark);
        }


        /* --- Sticky Search Header --- */
        .sticky-search-container {
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--header-bg);
            padding: calc(var(--spacing-unit) * 2);
            border-bottom: 1px solid var(--border-color);
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease, border-bottom-color 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        .header-top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 900px;
            margin-bottom: var(--spacing-unit);
            margin-left: auto;
            margin-right: auto;
        }

        .search-form {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: calc(var(--spacing-unit));
            width: 100%;
            max-width: 900px;
            padding: 0;
            margin-left: auto;
            margin-right: auto;
        }
        .search-form > input,
        .search-form > span,
        .search-form > button {
             max-width: none;
             margin-left: 0;
             margin-right: 0;
        }


        .search-input-group {
            display: contents;
        }

        .search-form label {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        #controlSearchInput {
             width: 100%;
        }

        #search-results-count {
            font-size: 0.85em;
            color: var(--label-color);
            text-align: left;
            width: 100%;
            padding-left: calc(var(--spacing-unit) / 2);
            order: 1;
            margin-bottom: 1rem;
        }

        .search-form button#searchBtn {
            width: 100%;
            margin: 0;
            order: 2;
        }
        .search-form button#selectControlBtn {
            width: 100%;
            margin: 0;
            order: 3;
        }


        /* --- Form Control Container --- */
        .form-control-item {
            margin: calc(var(--spacing-unit) * 4) auto;
            padding: 1rem 1.5rem;
            border-width: 0px;
            border-radius: 8px;
            background-color: transparent;
            max-width: 900px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            box-shadow: none;
        }
        body.dark-theme .form-control-item {
             box-shadow: none;
        }


        .form-control-item.hidden {
            display: none;
        }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        /* Common Input & Select Styling */
        input[type="text"],
        input[type="password"],
        input[type="email"],
        input[type="url"],
        input[type="tel"],
        input[type="number"],
        input[type="search"],
        input[type="date"],
        input[type="time"],
        input[type="datetime-local"],
        input[type="month"],
        input[type="week"],
        textarea,
        select {
            display: block;
            width: 100%;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            font-size: 1rem;
            line-height: 1.5;
            color: var(--text-color);
            background-color: var(--input-bg-color);
            background-clip: padding-box;
            border: 1px solid var(--input-border-color);
            border-radius: 4px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out, background-color 0.3s ease, color 0.3s ease;
            margin-top: calc(var(--spacing-unit) / 2);
            min-height: var(--min-control-height);
            vertical-align: middle;
        }

        select {
             padding-top: calc(var(--spacing-unit) * 0.75);
             padding-bottom: calc(var(--spacing-unit) * 0.75);
        }
        input[type="date"],
        input[type="time"],
        input[type="datetime-local"],
        input[type="month"],
        input[type="week"] {
             padding-top: calc(var(--spacing-unit) * 0.75);
             padding-bottom: calc(var(--spacing-unit) * 0.75);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Focus States */
        input:focus-visible,
        textarea:focus-visible,
        select:focus-visible,
        button:focus-visible,
        input[type="checkbox"]:focus-visible + label::before,
        input[type="radio"]:focus-visible + label::before,
        a.button-like:focus-visible,
        [role="switch"]:focus-visible,
        .switch input:focus-visible + .slider,
        .accordion-button:focus-visible,
        .carousel-button:focus-visible,
        .carousel-pagination button:focus-visible,
        [role="listbox"]:focus-visible,
        [role="option"]:focus-visible,
        .dialog button:focus-visible,
        .dialog input:focus-visible,
        .dialog [tabindex="-1"]:focus-visible,
        .control-select-dialog a:focus-visible
        {
            outline: 2px solid var(--focus-outline-color);
            outline-offset: 2px;
            border-color: var(--input-focus-border-color);
            box-shadow: 0 0 0 2px color-mix(in srgb, var(--focus-outline-color) 25%, transparent);
        }
        input:focus, textarea:focus, select:focus, button:focus, a:focus {
            outline: none;
        }


        /* Labels */
        label {
            display: inline-block;
            margin-bottom: calc(var(--spacing-unit) / 2);
            font-weight: bold;
            color: var(--label-color);
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .form-group label:not(.inline-label) {
             display: block;
        }


        /* Help Text / Descriptions */
        .help-text {
            font-size: 0.875em;
            color: var(--label-color);
            margin-top: calc(var(--spacing-unit) / 2);
            display: block;
            transition: color 0.3s ease;
        }

        /* Required Fields */
        .required-indicator {
            color: var(--error-color);
            margin-left: 2px;
            font-weight: bold;
        }
        label .required-indicator {
             font-weight: bold;
        }

        /* Fieldsets for Grouping */
        fieldset {
            border: 1px solid var(--border-color);
            padding: calc(var(--spacing-unit) * 2);
            margin-bottom: calc(var(--spacing-unit) * 2);
            border-radius: 4px;
            transition: border-color 0.3s ease;
        }

        legend {
            padding: 0 calc(var(--spacing-unit));
            font-weight: bold;
            color: var(--primary-color);
            transition: color 0.3s ease;
        }

        /* Buttons */
        button,
        input[type="submit"],
        input[type="reset"],
        input[type="button"],
        a.button-like
        {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 400;
            color: #fff;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            user-select: none;
            background-color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            font-size: 1rem;
            line-height: 1.5;
            border-radius: 4px;
            text-decoration: none;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            margin-right: var(--spacing-unit);
            margin-bottom: 0px;
            min-height: var(--min-control-height);
        }
         .form-group > button,
         .dialog_form_actions > button {
             margin-bottom: var(--spacing-unit);
         }
         .form-group > button:last-child,
         .dialog_form_actions > button:last-child {
              margin-bottom: 0;
         }


        button:hover,
        input[type="submit"]:hover,
        input[type="reset"]:hover,
        input[type="button"]:hover,
        a.button-like:hover {
            background-color: var(--primary-hover-color);
            border-color: var(--primary-hover-color);
            color: #fff;
            text-decoration: none;
        }

        /* Secondary/Cancel Button Style */
        button.secondary,
        a.button-like.secondary {
            color: var(--primary-color);
            background-color: transparent;
            border-color: var(--primary-color);
        }
        button.secondary:hover,
        a.button-like.secondary:hover {
            color: #fff;
            background-color: var(--primary-hover-color);
            border-color: var(--primary-hover-color);
        }
        body.dark-theme button.secondary:hover {
             color: var(--text-color-dark);
             background-color: color-mix(in srgb, var(--primary-color-dark) 30%, transparent);
        }


        /* Disabled State */
        input:disabled,
        textarea:disabled,
        select:disabled,
        button:disabled {
            background-color: var(--disabled-bg-color);
            opacity: 0.65;
            cursor: not-allowed;
            color: var(--disabled-text-color);
            border-color: var(--input-border-color);
        }
        input[type="checkbox"]:disabled + label,
        input[type="radio"]:disabled + label {
             color: var(--disabled-text-color);
             cursor: not-allowed;
        }
        input[type="checkbox"]:disabled + label::before,
        input[type="radio"]:disabled + label::before {
             background-color: var(--disabled-bg-color);
             border-color: color-mix(in srgb, var(--disabled-text-color) 50%, transparent);
             cursor: not-allowed;
        }


        /* Checkbox & Radio Button Custom Styling */
        .checkbox-group label,
        .radio-group label {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-unit);
            position: relative;
            padding-left: calc(var(--spacing-unit) * 3.5);
            min-height: calc(var(--spacing-unit) * 3);
            cursor: pointer;
            font-weight: normal;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        .checkbox-group input[type="checkbox"],
        .radio-group input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkbox-group label::before,
        .radio-group label::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: calc(var(--spacing-unit) * 2.5);
            width: calc(var(--spacing-unit) * 2.5);
            border: 1px solid var(--input-border-color);
            background-color: var(--input-bg-color);
            transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out;
        }

        .radio-group label::before { border-radius: 50%; }
        .checkbox-group label::before { border-radius: 3px; }


        .checkbox-group input[type="checkbox"]:checked + label::after {
            content: "";
            position: absolute;
            left: calc(var(--spacing-unit) * 0.75);
            top: 50%;
            width: calc(var(--spacing-unit) * 0.75);
            height: calc(var(--spacing-unit) * 1.5);
            border: solid var(--primary-color);
            border-width: 0 3px 3px 0;
            transform: translateY(-65%) rotate(45deg);
        }

        .radio-group input[type="radio"]:checked + label::after {
            content: "";
            position: absolute;
            left: calc(var(--spacing-unit) * 0.6);
            top: 50%;
            transform: translateY(-50%);
            height: calc(var(--spacing-unit) * 1.3);
            width: calc(var(--spacing-unit) * 1.3);
            border-radius: 50%;
            background: var(--primary-color);
        }

        .checkbox-group label:hover::before,
        .radio-group label:hover::before {
             border-color: var(--input-focus-border-color);
        }


        /* File Input Specific Styling */
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            margin-top: calc(var(--spacing-unit) / 2);
            min-height: var(--min-control-height);
            gap: var(--spacing-unit);
        }
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
         .file-input-wrapper .button-like {
             margin: 0;
             flex-shrink: 0;
         }
        .file-input-wrapper .file-name-display {
            display: inline-block;
            font-size: 0.9em;
            color: var(--label-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            transition: color 0.3s ease;
        }

        /* Range Input - Display Value */
        .range-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
            min-height: var(--min-control-height);
        }
        .range-group input[type="range"] {
             flex-grow: 1;
             margin-top: 0;
             height: var(--min-control-height);
             cursor: pointer;
        }
        .range-group .range-value {
            font-weight: bold;
            min-width: 3ch;
            text-align: right;
            color: var(--text-color);
            transition: color 0.3s ease;
        }


        /* Toggle Switch Styling */
        .switch {
          position: relative;
          display: inline-flex;
          align-items: center;
          width: 50px;
          height: 28px;
          vertical-align: middle;
          margin-top: calc(var(--spacing-unit) / 2);
          min-height: var(--min-control-height);
        }

        .switch input {
          opacity: 0;
          width: 0;
          height: 0;
          position: absolute;
        }

        .slider {
          position: absolute;
          cursor: pointer;
          top: 50%;
          transform: translateY(-50%);
          left: 0;
          right: 0;
          height: 28px;
          background-color: var(--input-border-color);
          transition: .4s;
          border-radius: 28px;
        }

        .slider:before {
          position: absolute;
          content: "";
          height: 20px;
          width: 20px;
          left: 4px;
          bottom: 4px;
          background-color: white;
          transition: .4s;
          border-radius: 50%;
        }
        body.dark-theme .slider:before {
            background-color: #ddd;
        }

        input:checked + .slider {
          background-color: var(--primary-color);
        }

        input:checked + .slider:before {
          transform: translateX(22px);
        }


        /* --- Scroll to Top Button --- */
        #scrollToTopBtn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 99;
            border: none;
            outline: none;
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            padding: 0;
            border-radius: 50%;
            font-size: 18px;
            width: 55px;
            height: 55px;
            line-height: 55px;
            text-align: center;
            opacity: 0.8;
            transition: opacity 0.3s ease, background-color 0.3s ease;
        }

        #scrollToTopBtn:hover {
            background-color: var(--primary-hover-color);
            opacity: 1;
        }
         #scrollToTopBtn:focus-visible {
            outline: 3px solid var(--focus-outline-color);
            outline-offset: 3px;
            opacity: 1;
         }
         #scrollToTopBtn::before {
            content: '';
            display: inline-block;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 10px solid white;
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
         }

        /* --- Utility Classes --- */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        .hidden {
            display: none !important;
        }


        /* --- Component Styles --- */

        /* Modal Dialog Styles */
        .dialog-overlay {
            position: fixed;
            inset: 0;
            background-color: var(--overlay-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        .dialog {
            background-color: var(--component-bg);
            border: 1px solid var(--component-border);
            border-radius: 8px;
            padding: calc(var(--spacing-unit) * 3);
            max-width: 600px;
            width: 90%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        .dialog-content {
             overflow-y: auto;
             flex-grow: 1;
        }

        .dialog-close-btn {
             position: absolute;
             top: var(--spacing-unit);
             right: var(--spacing-unit);
             background: transparent;
             border: none;
             font-size: 1.8rem;
             line-height: 1;
             padding: calc(var(--spacing-unit) / 2);
             cursor: pointer;
             color: var(--label-color);
             width: 40px;
             height: 40px;
             display: flex;
             align-items: center;
             justify-content: center;
             border-radius: 50%;
             margin: 0;
             min-height: auto;
             z-index: 1;
        }
         .dialog-close-btn:hover, .dialog-close-btn:focus {
              color: var(--text-color);
              background-color: color-mix(in srgb, var(--border-color) 20%, transparent);
         }

        .dialog_label {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-unit);
            margin-right: 40px;
            color: var(--primary-color);
            flex-shrink: 0;
        }
        .dialog_desc {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        .dialog_form .form-group {
            margin-bottom: var(--spacing-unit);
        }
        .dialog_form_actions {
            margin-top: calc(var(--spacing-unit) * 3);
            text-align: right;
            border-top: 1px solid var(--border-color);
            padding-top: calc(var(--spacing-unit) * 2);
            flex-shrink: 0;
        }
        .dialog_form_actions button {
            margin-left: var(--spacing-unit);
            margin-bottom: 0;
        }
        .dialog_form_actions button:first-child {
             margin-left: 0;
        }

        /* Control Select Dialog Specific Styles */
        #controlSelectDialog {
            max-width: 400px;
            height: 40vw !important;
            min-height: 300px;
            overflow: hidden;
        }
        #controlSelectList {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto; /* Make list scrollable */
            border: 1px solid var(--border-color);
            border-radius: 4px;
            flex-grow: 1;
            /* Removed max-height */
        }
        #controlSelectList li {
            margin-bottom: 0;
        }
        #controlSelectList a {
            display: block;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            color: var(--primary-color);
            text-decoration: none;
            border-bottom: 1px solid var(--border-color);
        }
        #controlSelectList li:last-child a {
            border-bottom: none;
        }
        #controlSelectList a:hover,
        #controlSelectList a:focus {
            background-color: color-mix(in srgb, var(--primary-color) 10%, var(--component-bg));
            text-decoration: underline;
            color: var(--primary-hover-color);
        }
        body.dark-theme #controlSelectList a {
             color: var(--primary-color-dark);
             border-color: var(--border-color-dark);
        }
         body.dark-theme #controlSelectList a:hover,
         body.dark-theme #controlSelectList a:focus {
             background-color: color-mix(in srgb, var(--primary-color-dark) 15%, var(--component-bg));
             color: var(--primary-hover-color-dark);
         }


        /* Accordion Styles */
        .accordion {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        .accordion-item {
            border-bottom: 1px solid var(--border-color);
        }
        .accordion-item:last-child {
            border-bottom: none;
        }
        .accordion-button {
            display: block;
            width: 100%;
            padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 2);
            background-color: var(--input-bg-color);
            border: none;
            text-align: left;
            font-size: 1rem;
            font-weight: bold;
            color: var(--text-color);
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s ease;
            min-height: var(--min-control-height);
        }
        .accordion-button:hover {
            background-color: color-mix(in srgb, var(--input-bg-color) 85%, var(--border-color));
        }
        .accordion-button::after {
            content: '';
            position: absolute;
            right: calc(var(--spacing-unit) * 2);
            top: 50%;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid currentColor;
            transform: translateY(-50%);
            transition: transform 0.2s ease;
        }
        .accordion-button[aria-expanded="true"]::after {
            transform: translateY(-50%) rotate(180deg);
        }
        .accordion-panel {
            padding: calc(var(--spacing-unit) * 2);
            background-color: var(--component-bg);
            border-top: 1px solid var(--border-color);
        }

        /* Alert Styles */
        .alert {
            padding: calc(var(--spacing-unit) * 1.5);
            margin-bottom: var(--spacing-unit) * 2;
            border: 1px solid transparent;
            border-radius: 4px;
            background-color: var(--alert-info-bg);
            border-color: var(--alert-info-border);
            color: var(--alert-info-text);
        }

        /* Breadcrumb Styles */
        .breadcrumb {
            padding: var(--spacing-unit) 0;
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: calc(var(--spacing-unit) / 2) var(--spacing-unit);
        }
        .breadcrumb li {
            display: inline-flex;
            align-items: center;
        }
        .breadcrumb li + li::before {
            content: "/";
            padding: 0 var(--spacing-unit);
            color: var(--label-color);
        }
        .breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
        }
        .breadcrumb a:hover, .breadcrumb a:focus {
            text-decoration: underline;
        }
        .breadcrumb [aria-current="page"] {
            color: var(--text-color);
            font-weight: bold;
            text-decoration: none;
            cursor: default;
        }

        /* Carousel Styles */
        .carousel {
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--input-bg-color);
        }
        .carousel-slides {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .carousel-slide {
            min-width: 100%;
            flex-shrink: 0;
            padding: calc(var(--spacing-unit) * 5);
            text-align: center;
            background-color: var(--component-bg);
            border: 1px solid var(--component-border);
            margin: 1px;
        }
        .carousel-slide img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto calc(var(--spacing-unit)*2);
            max-height: 300px;
        }
        .carousel-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: var(--spacing-unit);
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            line-height: 1;
        }
        .carousel-button.prev { left: var(--spacing-unit); }
        .carousel-button.next { right: var(--spacing-unit); }
        .carousel-button:hover, .carousel-button:focus {
            background-color: rgba(0, 0, 0, 0.8);
        }
        .carousel-pagination {
            position: absolute;
            bottom: var(--spacing-unit);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: var(--spacing-unit);
            z-index: 10;
        }
        .carousel-pagination button {
            background-color: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0,0,0,0.5);
            border-radius: 50%;
            width: 12px;
            height: 12px;
            padding: 0;
            cursor: pointer;
            min-height: auto;
            margin: 0;
        }
        .carousel-pagination button[aria-selected="true"] {
            background-color: rgba(0, 0, 0, 0.8);
        }
        .carousel-status {
             position: absolute;
             width: 1px;
             height: 1px;
             padding: 0;
             margin: -1px;
             overflow: hidden;
             clip: rect(0, 0, 0, 0);
             white-space: nowrap;
             border-width: 0;
        }

        /* Listbox Styles */
        .listbox-container {
            margin-top: var(--spacing-unit);
        }
        .listbox-label {
            display: block;
            font-weight: bold;
            margin-bottom: calc(var(--spacing-unit) / 2);
            color: var(--label-color);
        }
        [role="listbox"] {
            border: 1px solid var(--input-border-color);
            background-color: var(--input-bg-color);
            border-radius: 4px;
            padding: calc(var(--spacing-unit) / 2) 0;
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
        }
        [role="option"] {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            cursor: pointer;
            display: block;
        }
        [role="option"][aria-selected="true"] {
            background-color: var(--primary-color);
            color: white;
        }
        [role="option"]:hover, [role="option"]:focus {
             background-color: color-mix(in srgb, var(--primary-color) 20%, var(--input-bg-color));
             color: var(--text-color);
        }
        [role="option"][aria-selected="true"]:hover,
        [role="option"][aria-selected="true"]:focus {
            background-color: var(--primary-hover-color);
            color: white;
        }
        .listbox-group-label {
            padding: calc(var(--spacing-unit) / 2) calc(var(--spacing-unit) * 1.5);
            font-weight: bold;
            color: var(--label-color);
            font-style: italic;
            margin-top: var(--spacing-unit);
            border-top: 1px dashed var(--border-color);
        }
        .listbox-group-label:first-child {
             margin-top: 0;
             border-top: none;
        }
        [role="group"] [role="option"] {
             padding-left: calc(var(--spacing-unit) * 3);
        }
        .rearrange-listbox-wrapper {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-unit);
        }
        .rearrange-listbox-wrapper [role="listbox"] {
            flex-grow: 1;
        }
        .rearrange-buttons {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-unit) / 2);
            padding-top: calc(var(--spacing-unit) * 3);
        }
        .rearrange-buttons button {
            margin: 0;
            padding: calc(var(--spacing-unit) / 2) var(--spacing-unit);
            min-height: 30px;
            font-size: 0.9em;
        }


    </style>
</head>
<body>

    <header class="sticky-search-container">
        <div class="header-top-row">
            <h1>Controls Library</h1>
            <div class="theme-toggle-container">
                 <label for="themeToggle" id="themeToggleLabel" class="inline-label">Theme Toggle</label>
                 <label class="switch" aria-labelledby="themeToggleLabel">
                   <input type="checkbox" id="themeToggle" role="switch" aria-checked="false">
                   <span class="slider"></span>
                 </label>
            </div>
        </div>

        <form action="#" class="search-form" role="search" onsubmit="return false;">
            <label for="controlSearchInput">Search Components</label>
            <input type="search" id="controlSearchInput" placeholder="E.g., 'button', 'modal', 'accordion'">
            <span id="search-results-count" aria-live="polite"></span>
            <button type="submit" id="searchBtn" class="secondary" aria-label="Search Components">Search</button>
            <button type="button" id="selectControlBtn" class="secondary">Select Control</button> </form>
    </header>

    <main id="controls-container">

        <div class="form-control-item" id="accordion-section" data-keywords="accordion disclosure collapse expand section toggle">
            <h2>Accordion</h2>
            <p>A vertically stacked set of interactive headings that each reveal an associated section of content.</p>
            <div class="accordion" id="myAccordion">
                </div>
            <pre><code>&lt;!-- ... Accordion HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes (Accordion)</h3>
                </div>
        </div>

        <div class="form-control-item" id="alert-section" data-keywords="alert notification message status assertive polite live region">
            <h2>Alert</h2>
            <p>Provides brief, important, and usually time-sensitive information. Often appears dynamically.</p>
            <button type="button" id="triggerAlertBtn">Trigger Alert</button>
            <div id="alertContainer">
                </div>
            <pre><code>&lt;!-- ... Alert HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes (Alert)</h3>
                </div>
        </div>

        <div class="form-control-item" id="breadcrumb-trail-section" data-keywords="breadcrumb navigation path trail hierarchy site structure">
            <h2>Breadcrumb Trail</h2>
            <p>Shows the user's current location within the site hierarchy and provides links to parent pages.</p>
            <nav aria-label="Breadcrumb">
                <ol class="breadcrumb">
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Products</a></li>
                    <li><a href="#">Accessories</a></li>
                    <li aria-current="page"><span>Headphones</span></li> </ol>
            </nav>
            <pre><code>&lt;!-- ... Breadcrumb HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes (Breadcrumb)</h3>
                </div>
        </div>

        <div class="form-control-item" id="buttons-section" data-keywords="button submit reset cancel action click interactive">
            <h2>Buttons</h2>
            <p>Elements to trigger actions.</p>
            <div class="form-group">
                <button type="submit">Submit Form</button>
                <button type="reset" class="secondary">Reset Fields</button>
                <button type="button" class="secondary">Cancel</button>
                <button type="button" disabled>Disabled Action</button>
                <a href="#some-section" class="button-like secondary" role="button">Link as Button</a>
            </div>
             <pre><code>&lt;!-- ... Buttons HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                </div>
        </div>

        <div class="form-control-item" id="carousel-slideshow-section" data-keywords="carousel slider slideshow rotator image gallery banner">
            <h2>Carousel / Slideshow</h2>
            <p>A rotating set of content items (e.g., images, cards). Accessibility requires careful handling of controls and announcements.</p>
            <div class="carousel"
                 aria-roledescription="carousel"
                 aria-label="Featured Items Showcase">

                 <div class="carousel-status" aria-live="polite" aria-atomic="true">
                     </div>

                <div class="carousel-slides">
                    <div class="carousel-slide"
                         role="group"
                         aria-roledescription="slide"
                         aria-label="1 of 3"> <img src="https://placehold.co/600x300/f0f0f0/333?text=Slide+1" alt="Placeholder Slide 1">
                         <p>Content for Slide 1</p>
                    </div>
                    <div class="carousel-slide"
                         role="group"
                         aria-roledescription="slide"
                         aria-label="2 of 3">
                         <img src="https://placehold.co/600x300/e0e0e0/333?text=Slide+2" alt="Placeholder Slide 2">
                         <p>Content for Slide 2</p>
                    </div>
                    <div class="carousel-slide"
                         role="group"
                         aria-roledescription="slide"
                         aria-label="3 of 3">
                         <img src="https://placehold.co/600x300/d0d0d0/333?text=Slide+3" alt="Placeholder Slide 3">
                         <p>Content for Slide 3</p>
                    </div>
                </div>

                <button type="button" class="carousel-button prev" aria-label="Previous Slide">‹</button>
                <button type="button" class="carousel-button next" aria-label="Next Slide">›</button>

                <div class="carousel-pagination" role="tablist" aria-label="Slides">
                    <button type="button" role="tab" aria-selected="true" aria-controls="slide-1-content" aria-label="Slide 1"></button>
                    <button type="button" role="tab" aria-selected="false" aria-controls="slide-2-content" aria-label="Slide 2"></button>
                    <button type="button" role="tab" aria-selected="false" aria-controls="slide-3-content" aria-label="Slide 3"></button>
                </div>
            </div>
            <pre><code>&lt;!-- ... Carousel HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes (Carousel)</h3>
                </div>
        </div>

        <div class="form-control-item" id="checkbox-section" data-keywords="checkbox check box toggle boolean option select multiple">
            <h2>Checkbox</h2>
            <p>Allows users to select zero or more options.</p>
            <fieldset class="checkbox-group">
                 <legend>Notification Preferences</legend>
                 <div class="form-group">
                    <input type="checkbox" id="checkNews" name="notifications" value="newsletter" checked>
                    <label for="checkNews" class="inline-label">Subscribe to Newsletter</label>
                 </div>
                 <div class="form-group">
                     <input type="checkbox" id="checkUpdates" name="notifications" value="updates">
                     <label for="checkUpdates" class="inline-label">Receive Product Updates</label>
                 </div>
                 <div class="form-group">
                     <input type="checkbox" id="checkOffers" name="notifications" value="offers" disabled>
                     <label for="checkOffers" class="inline-label">Get Special Offers (Unavailable)</label>
                 </div>
            </fieldset>
             <pre><code>&lt;!-- ... Checkbox HTML ... --&gt;</code></pre>
             <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                </div>
        </div>

        <div class="form-control-item" id="date-and-time-input-section" data-keywords="datetime date time local input picker timestamp">
            <h2>Date and Time Input</h2>
            <p>Allows users to select both date and time (local).</p>
            <div class="form-group">
                <label for="datetimeInputExample">Event Start Date/Time</label>
                <input type="datetime-local" id="datetimeInputExample" name="event_start" aria-describedby="datetimeHelp">
                <small id="datetimeHelp" class="help-text">Select date and local time.</small>
            </div>
            <pre><code>&lt;!-- ... DateTime Input HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                </div>
        </div>

        <div class="form-control-item" id="date-input-section" data-keywords="date input picker calendar select day month year">
            <h2>Date Input</h2>
            <p>Allows users to select a specific date.</p>
            <div class="form-group">
                <label for="dateInputExample">Appointment Date</label>
                <input type="date" id="dateInputExample" name="appointment_date" min="2024-01-01" max="2025-12-31" aria-describedby="dateHelp">
                <small id="dateHelp" class="help-text">Format: MM/DD/YYYY. Use calendar or type.</small>
            </div>
            <pre><code>&lt;!-- ... Date Input HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                </div>
        </div>

        <div class="form-control-item" id="email-input-section" data-keywords="email address input contact">
            <h2>Email Input</h2>
            <p>Input specifically for email addresses.</p>
            <div class="form-group">
                <label for="emailInputExample">Email Address</label>
                <input type="email" id="emailInputExample" name="user_email" placeholder="you@example.com" aria-describedby="emailHelp">
                 <small id="emailHelp" class="help-text">We'll never share your email with anyone else.</small>
            </div>
            <pre><code>&lt;!-- ... Email Input HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                </div>
        </div>

        <div class="form-control-item" id="file-input-upload-section" data-keywords="file input upload attachment select image document">
            <h2>File Input / Upload</h2>
            <p>Allows users to select files for upload.</p>
            <div class="form-group">
                 <label for="fileInputExample">Upload Your Resume (PDF or DOCX)</label>
                 <div class="file-input-wrapper">
                    <button type="button" class="button-like secondary" aria-hidden="true" tabindex="-1">Choose File</button>
                    <span class="file-name-display" id="fileNameDisplayResume">No file chosen</span>
                    <input type="file" id="fileInputExample" name="resume" accept=".pdf,.docx,.doc" aria-describedby="fileHelp resumeConstraints" onchange="document.getElementById('fileNameDisplayResume').textContent = this.files.length > 0 ? this.files[0].name : 'No file chosen';">
                </div>
                <small id="fileHelp" class="help-text">Max file size: 5MB.</small>
                <div id="resumeConstraints" class="help-text">Accepted formats: PDF, DOC, DOCX.</div>
            </div>
            <pre><code>&lt;!-- ... File Input HTML ... --&gt;</code></pre>
            <p><em>Note: Basic styling provided. Robust JS often needed.</em></p>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                </div>
        </div>

        <div class="form-control-item" id="hidden-input-section" data-keywords="hidden input invisible data parameter form submission">
            <h2>Hidden Input</h2>
            <p>Non-visible input for submitting data.</p>
            <form>
                <input type="hidden" id="csrfToken" name="_csrf_token" value="aBcDeF12345GHIjkl">
                <input type="hidden" id="sessionId" name="session_id" value="zyXwVu98765TsRqPo">
            </form>
             <pre><code>&lt;!-- ... Hidden Input HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                </div>
        </div>

        <div class="form-control-item" id="listbox-examples-section" data-keywords="listbox select list options scrollable grouped rearrangeable multiselect">
            <h2>Listbox Examples</h2>
            <p>Allows selection from a list of options, similar to a native select but often used for custom UI or multi-select.</p>

            <h3>Scrollable Listbox</h3>
            <div class="listbox-container">
                <label id="lb1-label" class="listbox-label">Choose your primary skill:</label>
                <ul id="lb1"
                    tabindex="0"
                    role="listbox"
                    aria-labelledby="lb1-label"
                    aria-activedescendant=""> <li id="lb1-opt1" role="option" aria-selected="false">HTML</li>
                    <li id="lb1-opt2" role="option" aria-selected="false">CSS</li>
                    <li id="lb1-opt3" role="option" aria-selected="false">JavaScript</li>
                    <li id="lb1-opt4" role="option" aria-selected="false">React</li>
                    <li id="lb1-opt5" role="option" aria-selected="false">Angular</li>
                    <li id="lb1-opt6" role="option" aria-selected="false">Vue</li>
                    <li id="lb1-opt7" role="option" aria-selected="false">Python</li>
                    <li id="lb1-opt8" role="option" aria-selected="false">PHP</li>
                    <li id="lb1-opt9" role="option" aria-selected="false">Ruby</li>
                </ul>
            </div>
            <pre><code>&lt;!-- ... Scrollable Listbox HTML ... --&gt;</code></pre>

            <h3 style="margin-top: calc(var(--spacing-unit)*4);">Listbox with Grouped Options</h3>
             <div class="listbox-container">
                <label id="lb2-label" class="listbox-label">Choose a framework/library:</label>
                <ul id="lb2"
                    tabindex="0"
                    role="listbox"
                    aria-labelledby="lb2-label"
                    aria-activedescendant="">
                    <li role="presentation" class="listbox-group-label" id="lb2-group1-label">Frontend</li>
                    <li id="lb2-opt1" role="option" aria-selected="false">React</li>
                    <li id="lb2-opt2" role="option" aria-selected="false">Angular</li>
                    <li id="lb2-opt3" role="option" aria-selected="false">Vue</li>
                    <li role="presentation" class="listbox-group-label" id="lb2-group2-label">Backend</li>
                    <li id="lb2-opt4" role="option" aria-selected="false">Node.js</li>
                    <li id="lb2-opt5" role="option" aria-selected="false">Django</li>
                    <li id="lb2-opt6" role="option" aria-selected="false">Ruby on Rails</li>
                </ul>
            </div>
             <pre><code>&lt;!-- ... Grouped Listbox HTML ... --&gt;</code></pre>


            <h3 style="margin-top: calc(var(--spacing-unit)*4);">Listbox with Rearrangeable Options (Simplified)</h3>
            <p><em>Note: Full keyboard support for rearranging is complex and omitted here. This example focuses on structure and basic interaction.</em></p>
            <div class="rearrange-listbox-wrapper">
                 <div class="listbox-container" style="flex-grow: 1;">
                    <label id="lb3-label" class="listbox-label">Prioritize Tasks:</label>
                    <ul id="lb3"
                        tabindex="0"
                        role="listbox"
                        aria-labelledby="lb3-label"
                        aria-multiselectable="false"
                        aria-activedescendant="">
                        <li id="lb3-opt1" role="option" aria-selected="false">Task A: Design Mockups</li>
                        <li id="lb3-opt2" role="option" aria-selected="false">Task B: Develop API</li>
                        <li id="lb3-opt3" role="option" aria-selected="false">Task C: Write Tests</li>
                        <li id="lb3-opt4" role="option" aria-selected="false">Task D: User Documentation</li>
                    </ul>
                </div>
                 <div class="rearrange-buttons">
                     <button type="button" aria-label="Move selected item up" class="move-up-btn">▲</button>
                     <button type="button" aria-label="Move selected item down" class="move-down-btn">▼</button>
                 </div>
            </div>
             <pre><code>&lt;!-- ... Rearrangeable Listbox HTML ... --&gt;</code></pre>

            <div class="accessibility-notes">
                <h3>Accessibility Notes (Listbox)</h3>
                <ul>
                    <li><strong>Role Structure:</strong> The container element has `role="listbox"`. Each selectable item within it has `role="option"`.</li>
                    <li><strong>Labeling:</strong> The listbox must have an accessible name, usually via `aria-labelledby` pointing to a visible `<label>` element.</li>
                    <li><strong>Focus Management:**
                        <ul>
                            <li>Typically, the listbox container itself is made focusable (`tabindex="0"`).</li>
                            <li>Focus remains on the listbox container while the user navigates *options* using arrow keys.</li>
                            <li>`aria-activedescendant` on the listbox container is updated via JS to point to the `id` of the currently *visually focused* option. This tells assistive technology which option is active without actually moving DOM focus to it.</li>
                            <li>Options themselves usually have `tabindex="-1"` (or no tabindex) so they aren't in the default tab order.</li>
                        </ul>
                    </li>
                    <li><strong>Selection State:** Use `aria-selected="true|false"` on each option to indicate whether it's selected. Update via JS on user interaction (click, Enter, Space).</li>
                    <li><strong>Multi-Select:** If multiple options can be selected, add `aria-multiselectable="true"` to the listbox container. Selection logic needs to handle Shift+Arrow, Ctrl+Click, Ctrl+Space, etc.</li>
                    <li><strong>Keyboard Navigation (Essential):**
                        <ul>
                            <li>Down/Up Arrow: Move visual focus (`aria-activedescendant`) to the next/previous option.</li>
                            <li>Home/End: Move visual focus to the first/last option.</li>
                            <li>PageUp/PageDown (Optional): Scroll and move focus up/down by a larger amount.</li>
                            <li>Letter Keys: Move focus to the next option starting with that letter (type-ahead).</li>
                            <li>Enter/Space: Select/deselect the focused option (toggle in multi-select).</li>
                        </ul>
                        (WCAG 2.1.1 Keyboard)
                    </li>
                     <li><strong>Scrollable Listbox:** Ensure keyboard navigation automatically scrolls the focused option (`aria-activedescendant`) into view.</li>
                     <li><strong>Grouped Listbox:** Use `role="presentation"` on list items acting as group labels to remove them from the option count/navigation. Alternatively, use `role="group"` around sets of options with `aria-labelledby` pointing to the group label's ID. Keyboard navigation should typically skip over group labels.</li>
                     <li><strong>Rearrangeable Listbox:** This adds significant complexity. In addition to standard listbox behavior:
                        <ul>
                            <li>Provide explicit visual buttons (Up/Down) for reordering.</li>
                            <li>Provide a keyboard-only mechanism for reordering (e.g., Ctrl+Arrow keys when an item is selected). This requires capturing key events and manipulating the DOM order.</li>
                            <li>Ensure screen readers announce the item's new position after moving.</li>
                            <li>Consider drag-and-drop as an *enhancement*, but it must have a keyboard equivalent.</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="modal-dialog-section" data-keywords="modal dialog popup window overlay accessible focus trap">
            <h2>Modal Dialog</h2>
            <p>A window overlaid on the primary content, requiring user interaction. Must trap focus and be dismissible.</p>
            <button type="button" id="openDialogBtn" data-dialog-id="addressDialog">
                Open Address Dialog
            </button>

            <div id="addressDialogOverlay" class="dialog-overlay hidden"> <div role="dialog"
                     id="addressDialog"
                     aria-labelledby="dialog1_label"
                     aria-modal="true"
                     class="dialog">
                    <button type="button" class="dialog-close-btn" aria-label="Close dialog">&times;</button>
                    <h2 id="dialog1_label" class="dialog_label">
                        Add Delivery Address
                    </h2>
                    <form class="dialog_form">
                        <div class="form-group">
                            <label for="dialog-street">Street:</label>
                            <input type="text" id="dialog-street" class="wide_input">
                        </div>
                        <div class="form-group">
                            <label for="dialog-city">City:</label>
                            <input type="text" id="dialog-city" class="city_input">
                        </div>
                        <div class="form-group">
                            <label for="dialog-state">State:</label>
                            <input type="text" id="dialog-state" class="state_input">
                        </div>
                         <div class="form-group">
                            <label for="dialog-zip">Zip:</label>
                            <input type="text" id="dialog-zip" class="zip_input">
                        </div>
                    </form>
                    <div class="dialog_form_actions">
                        <button type="button" class="dialog-add-btn">Add</button>
                        <button type="button" class="dialog-cancel-btn secondary">Cancel</button>
                    </div>
                </div>
            </div>

            <pre><code>&lt;!-- ... Modal Dialog HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes (Modal Dialog)</h3>
                <ul>
                    <li><strong>Role & State:</strong> Use `role="dialog"` and `aria-modal="true"`.</li>
                    <li><strong>Labeling:</strong> Provide a label using `aria-labelledby` pointing to a visible heading (`h2` preferred).</li>
                    <li><strong>Description (Optional):</strong> Use `aria-describedby` to point to descriptive text if needed.</li>
                    <li><strong>Visibility & Overlay:</strong> Dialog and its overlay should be hidden initially. Use JS to show/hide the overlay. The overlay visually obscures the background content.</li>
                    <li><strong>Focus Management (CRITICAL):**
                        <ul>
                            <li>When opened, focus moves inside the dialog (e.g., first input or close button).</li>
                            <li>Focus is trapped within the dialog.</li>
                            <li>When closed, focus returns to the trigger element.</li>
                        </ul>
                        (WCAG 2.4.3 Focus Order, 2.1.1 Keyboard)
                    </li>
                    <li><strong>Keyboard Dismissal:</strong> Allow closing via Escape key.</li>
                    <li><strong>Dismiss Button:</strong> Provide a clearly labeled, keyboard-accessible close button (e.g., using `&times;` with an `aria-label`).</li>
                    <li><strong>Background Inertness:** Use JS focus trapping. Optionally use `aria-hidden="true"` on background elements or the `<dialog>` element's native behavior.</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="month-input-section" data-keywords="month input picker select year month">
            <h2>Month Input</h2>
            <p>Allows users to select month and year.</p>
            <div class="form-group">
                 <label for="monthInputExample">Billing Cycle Month</label>
                 <input type="month" id="monthInputExample" name="billing_month" min="2024-01" max="2025-12" aria-describedby="monthHelp">
                 <small id="monthHelp" class="help-text">Select billing month/year (YYYY-MM).</small>
            </div>
            <pre><code>&lt;!-- ... Month Input HTML ... --&gt;</code></pre>
             <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                 <ul>
                    <li><strong>Label Association:</strong> Essential (<code>for</code>/<code>id</code>).</li>
                    <li><strong>Native Picker Variance:</strong> Varies. TEST.</li>
                    <li><strong>Format Hint:</strong> Value format YYYY-MM.</li>
                    <li><strong>Keyboard/Custom Pickers:</strong> Similar considerations as Date.</li>
                    <li><strong>Target Size:</strong> Ensure min. 44px height. (WCAG 2.5.5)</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="number-input-section" data-keywords="number numeric input integer float quantity amount spinner">
            <h2>Number Input</h2>
            <p>Input for numerical values.</p>
             <div class="form-group">
                 <label for="numberInputExample">Quantity</label>
                 <input type="number" id="numberInputExample" name="quantity" min="1" max="10" step="1" value="1" aria-describedby="numberHelp">
                 <small id="numberHelp" class="help-text">Enter whole number (1-10).</small>
            </div>
            <pre><code>&lt;!-- ... Number Input HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                 <ul>
                    <li><strong>Label Association:</strong> Essential (<code>for</code>/<code>id</code>).</li>
                    <li><strong>Type Attribute:</strong> `type="number"` triggers numeric keyboard.</li>
                    <li><strong>Spinner Controls:</strong> Accessibility varies. Test. Ensure direct typing works.</li>
                    <li><strong>Min/Max/Step:</strong> Use attributes to define constraints. (WCAG 3.3.2)</li>
                    <li><strong>Validation:</strong> Native validation checks format/range.</li>
                    <li><strong>Target Size:</strong> Ensure min. 44px height. (WCAG 2.5.5)</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="password-input-section" data-keywords="password secret input secure">
            <h2>Password Input</h2>
            <p>Input for sensitive information.</p>
            <div class="form-group">
                <label for="passwordInputExample">Password</label>
                <input type="password" id="passwordInputExample" name="user_pass" required aria-required="true" aria-describedby="passwordHelp">
                 <small id="passwordHelp" class="help-text">Must be at least 8 characters long.</small>
            </div>
             <pre><code>&lt;!-- ... Password Input HTML ... --&gt;</code></pre>
             <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                <ul>
                    <li>Follows Text Input principles.</li>
                    <li><code>type="password"</code> masks input.</li>
                    <li>Consider accessible <strong>"Show/Hide" toggle button</strong> (clear label, state announcement via ARIA, keyboard accessible, sufficient target size). (WCAG 4.1.2)</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="radio-buttons-section" data-keywords="radio button option select single choice">
            <h2>Radio Buttons</h2>
            <p>Allows users to select exactly one option.</p>
             <fieldset class="radio-group">
                 <legend>Preferred Contact Method <span class="required-indicator" aria-hidden="true">*</span></legend>
                 <div class="form-group">
                    <input type="radio" id="contactEmail" name="contact_method" value="email" checked required aria-required="true">
                    <label for="contactEmail" class="inline-label">Email</label>
                 </div>
                 <div class="form-group">
                    <input type="radio" id="contactPhone" name="contact_method" value="phone" required aria-required="true">
                    <label for="contactPhone" class="inline-label">Phone</label>
                 </div>
                 <div class="form-group">
                     <input type="radio" id="contactMail" name="contact_method" value="mail" required aria-required="true" disabled>
                     <label for="contactMail" class="inline-label">Postal Mail (Unavailable)</label>
                 </div>
            </fieldset>
             <pre><code>&lt;!-- ... Radio Buttons HTML ... --&gt;</code></pre>
             <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                <ul>
                    <li><strong>Label Association:</strong> CRITICAL (<code>for</code>/<code>id</code>).</li>
                    <li><strong>Grouping:</strong> MUST use <code>&lt;fieldset&gt;</code>/<code>&lt;legend&gt;</code>.</li>
                    <li><strong>`name` Attribute:</strong> MUST be identical for all radios in a group. (WCAG 1.3.1, 4.1.2)</li>
                    <li><strong>State:</strong> `checked` attribute. Announced by screen readers.</li>
                    <li><strong>Keyboard:</strong> Arrow keys navigate within group; Spacebar selects. Tab moves in/out of group.</li>
                    <li><strong>Default Selection:</strong> Recommended.</li>
                    <li><strong>Target Size:</strong> Ensure label provides sufficient clickable area. (WCAG 2.5.5)</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="range-input-slider-section" data-keywords="range input slider select value volume brightness percentage">
            <h2>Range Input (Slider)</h2>
            <p>Allows selection of a value within a range.</p>
            <div class="form-group range-group">
                <label for="rangeInputExample">Volume</label>
                <input type="range" id="rangeInputExample" name="volume" min="0" max="100" step="1" value="50" aria-describedby="rangeValueHelp">
                <output for="rangeInputExample" class="range-value" id="rangeValueOutput">50</output>
                <small id="rangeValueHelp" class="help-text visually-hidden">Use arrows. Value displayed.</small>
            </div>
            <script> /* JS included in main script block */ </script>
            <pre><code>&lt;!-- ... Range Input HTML ... --&gt;</code></pre>
             <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                 <ul>
                    <li><strong>Label Association:</strong> Essential (<code>for</code>/<code>id</code>).</li>
                    <li><strong>Communicating Value:</strong> CRITICAL. Must provide current value accessibly (e.g., update text via JS using `<output>`, use `aria-valuetext`). (WCAG 4.1.2)</li>
                    <li><strong>Keyboard:</strong> Arrow keys adjust; Home/End jump.</li>
                    <li><strong>Min/Max/Step:</strong> Define range/increments.</li>
                    <li><strong>Target Size:</strong> Ensure slider thumb/track provides adequate target area (min height helps). (WCAG 2.5.5)</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="search-input-content-area-example-section" data-keywords="search find query input filter content">
            <h2>Search Input (Content Area Example)</h2>
            <p>Input specifically for search queries within the main content area.</p>
             <div class="form-group" role="search">
                <label for="searchInputExampleContent">Search Documentation</label>
                <div style="display: flex; align-items: center; gap: var(--spacing-unit);">
                    <input type="search" id="searchInputExampleContent" name="query_content" placeholder="Enter search term..." style="flex-grow: 1;">
                    <button type="submit" class="secondary" aria-label="Search Documentation">Search</button>
                </div>
            </div>
            <pre><code>&lt;!-- ... Search Input HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                 <ul>
                    <li>Follows Text Input principles (for input and button).</li>
                    <li><code>type="search"</code> may provide 'clear' button.</li>
                    <li>Visible label recommended.</li>
                    <li>Button association usually automatic with `type="submit"`.</li>
                    <li>Use <strong>`aria-live` region</strong> for announcing dynamic results if applicable. (WCAG 4.1.3)</li>
                    <li><strong>`role="search"`</strong> provides landmark.</li>
                 </ul>
            </div>
        </div>

        <div class="form-control-item" id="select-dropdown-section" data-keywords="select dropdown drop down list options picker menu">
            <h2>Select (Dropdown)</h2>
            <p>Allows users to select one option from a list.</p>
            <div class="form-group">
                <label for="selectExample">Select Your Country</label>
                <select id="selectExample" name="country">
                    <option value="" disabled selected>--Please choose an option--</option>
                    <optgroup label="North America">
                        <option value="CA">Canada</option>
                        <option value="MX">Mexico</option>
                        <option value="US">United States</option>
                    </optgroup>
                    <optgroup label="Europe">
                        <option value="FR">France</option>
                        <option value="DE">Germany</option>
                        <option value="UK">United Kingdom</option>
                    </optgroup>
                     <option value="OTHER">Other</option>
                </select>
            </div>
            <pre><code>&lt;!-- ... Select HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                <ul>
                    <li><strong>Label Association:</strong> Essential (<code>for</code>/<code>id</code>).</li>
                    <li><strong>Native Element:</strong> Generally very accessible.</li>
                    <li><strong>Options:</strong> Use <code>&lt;option&gt;</code> (text is read, `value` submitted).</li>
                    <li><strong>Option Groups:</strong> Use <code>&lt;optgroup&gt;</code> for semantic grouping.</li>
                    <li><strong>Placeholder Option:</strong> Use a disabled, selected first option with `value=""`.</li>
                    <li><strong>Keyboard:</strong> Space/Alt+Down opens; Arrows navigate; Enter selects; Typing jumps.</li>
                    <li><strong>Custom Selects:</strong> Avoid unless necessary; complex to make accessible.</li>
                    <li><strong>Target Size:</strong> Ensure min. 44px height. (WCAG 2.5.5)</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="text-input-section" data-keywords="text input field textfield string">
            <h2>Text Input</h2>
            <p>Standard input for single-line text.</p>
            <div class="form-group">
                <label for="textInputExample" class="label-block">Your Name <span class="required-indicator" aria-hidden="true">*</span></label>
                <input type="text" id="textInputExample" name="username" placeholder="E.g., Jane Doe" required aria-required="true" aria-describedby="nameHelp">
                <small id="nameHelp" class="help-text">Please enter your full name.</small>
            </div>
            <pre><code>&lt;!-- ... Text Input HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                <ul>
                    <li><strong>Label Association:</strong> The <code>&lt;label&gt;</code>'s <code>for</code> attribute must match the <code>&lt;input&gt;</code>'s <code>id</code>. (WCAG 1.3.1, 3.3.2, 4.1.2)</li>
                    <li><strong>Visible Label:</strong> Must always be visible.</li>
                    <li><strong>Placeholder:</strong> Use only for hints, not labels. (WCAG 1.3.1, 3.3.2)</li>
                    <li><strong>Required Fields:</strong> Indicate visually and programmatically (<code>required</code>/<code>aria-required="true"</code>). (WCAG 3.3.2)</li>
                    <li><strong>Instructions/Hints:</strong> Link via <code>aria-describedby</code>. (WCAG 3.3.2)</li>
                    <li><strong>Focus Indicator:</strong> Ensure clear visual focus. (WCAG 2.4.7, 2.4.11)</li>
                    <li><strong>Target Size:</strong> Ensure min. 44px height. (WCAG 2.5.5)</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="textarea-section" data-keywords="textarea multi-line text input large comments feedback">
            <h2>Textarea</h2>
            <p>Input for multi-line text entry.</p>
            <div class="form-group">
                <label for="textareaExample">Your Comments</label>
                <textarea id="textareaExample" name="comments" rows="5" placeholder="Enter your feedback here..." aria-describedby="commentsHelp"></textarea>
                <small id="commentsHelp" class="help-text">Max 500 characters.</small>
            </div>
            <pre><code>&lt;!-- ... Textarea HTML ... --&gt;</code></pre>
             <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                <ul>
                    <li>Follows Text Input principles.</li>
                    <li>Inherently accessible with label.</li>
                    <li>Specify constraints (e.g., `maxlength`) if applicable.</li>
                    <li>Ensure sufficient height for usability.</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="time-input-section" data-keywords="time input picker clock select hour minute second">
            <h2>Time Input</h2>
            <p>Allows users to select a specific time.</p>
            <div class="form-group">
                 <label for="timeInputExample">Meeting Start Time</label>
                 <input type="time" id="timeInputExample" name="start_time" min="09:00" max="17:00" step="1800" aria-describedby="timeHelp">
                 <small id="timeHelp" class="help-text">Select time (9AM-5PM, 30min intervals).</small>
            </div>
             <pre><code>&lt;!-- ... Time Input HTML ... --&gt;</code></pre>
             <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                 <ul>
                    <li><strong>Label Association:</strong> Essential (<code>for</code>/<code>id</code>).</li>
                    <li><strong>Native Picker Variance:</strong> Varies by browser. TEST.</li>
                    <li><strong>Format Hint:</strong> Provide hints (<code>aria-describedby</code>).</li>
                    <li><strong>Keyboard Input:</strong> Should allow direct typing.</li>
                    <li><strong>Custom Pickers:</strong> Consider accessible libraries if needed.</li>
                     <li><strong>Min/Max/Step:</strong> Use `min`/`max`/`step` attributes.</li>
                     <li><strong>Target Size:</strong> Ensure min. 44px height. (WCAG 2.5.5)</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="toggle-switch-section" data-keywords="toggle switch on off boolean checkbox role switch">
             <h2>Toggle Switch</h2>
             <p>Visually distinct on/off control.</p>
             <div class="form-group" style="display: flex; align-items: center; gap: var(--spacing-unit);">
                 <label for="toggleSwitchExample" id="toggleSwitchLabel" class="inline-label" style="margin-bottom: 0;">Enable Feature X</label>
                 <label class="switch" aria-labelledby="toggleSwitchLabel">
                   <input type="checkbox" id="toggleSwitchExample" name="feature_x_enabled" role="switch">
                   <span class="slider"></span>
                 </label>
            </div>
             <pre><code>&lt;!-- ... Toggle Switch HTML ... --&gt;</code></pre>
             <div class="accessibility-notes">
                 <h3>Accessibility Notes</h3>
                 <ul>
                     <li><strong>Underlying Element:</strong> Use hidden checkbox for state.</li>
                     <li><strong>Label Association:</strong> Associate label with checkbox (<code>for</code>/<code>id</code> or wrap). `aria-labelledby` on switch points to label.</li>
                     <li><strong>ARIA Role:</strong> Use `role="switch"` on input or interactive container. (WCAG 4.1.2)</li>
                     <li><strong>ARIA State:</strong> Use `aria-checked="true/false"`, kept in sync via JS.</li>
                     <li><strong>Keyboard Interaction:</strong> Spacebar toggles.</li>
                     <li><strong>Visual Design:</strong> Clear on/off states, sufficient contrast.</li>
                     <li><strong>Focus Indicator:</strong> Clear focus style on switch.</li>
                     <li><strong>Target Size:</strong> Clickable switch element needs min. 44px size. (WCAG 2.5.5)</li>
                 </ul>
             </div>
         </div>

        <div class="form-control-item" id="url-input-section" data-keywords="url web address website link input">
            <h2>URL Input</h2>
            <p>Input for web addresses (URLs).</p>
            <div class="form-group">
                <label for="urlInputExample">Website URL</label>
                <input type="url" id="urlInputExample" name="website" placeholder="https://example.com">
            </div>
             <pre><code>&lt;!-- ... URL Input HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                <ul>
                    <li>Follows Text Input principles.</li>
                    <li><code>type="url"</code> provides native validation & optimized keyboard. (WCAG 3.3.1)</li>
                </ul>
            </div>
        </div>

        <div class="form-control-item" id="week-input-section" data-keywords="week input picker select year week">
            <h2>Week Input</h2>
            <p>Allows users to select week and year.</p>
            <div class="form-group">
                <label for="weekInputExample">Select Project Week</label>
                <input type="week" id="weekInputExample" name="project_week" min="2024-W01" max="2025-W52" aria-describedby="weekHelp">
                <small id="weekHelp" class="help-text">Select project week (YYYY-W##).</small>
            </div>
            <pre><code>&lt;!-- ... Week Input HTML ... --&gt;</code></pre>
            <div class="accessibility-notes">
                <h3>Accessibility Notes</h3>
                <ul>
                    <li><strong>Label Association:</strong> Essential (<code>for</code>/<code>id</code>).</li>
                    <li><strong>Native Picker Variance:</strong> Varies. TEST.</li>
                    <li><strong>Format Hint:</strong> Value format YYYY-W##.</li>
                     <li><strong>Keyboard/Custom Pickers:</strong> Similar considerations as Date.</li>
                     <li><strong>Target Size:</strong> Ensure min. 44px height. (WCAG 2.5.5)</li>
                </ul>
            </div>
        </div>


    </main>

    <div id="addressDialogOverlay" class="dialog-overlay hidden">
        </div>

    <div id="controlSelectDialogOverlay" class="dialog-overlay hidden">
        <div role="dialog"
             id="controlSelectDialog"
             aria-labelledby="controlSelectDialogLabel"
             aria-modal="true"
             class="dialog control-select-dialog">
            <button type="button" class="dialog-close-btn" aria-label="Close control selection">&times;</button>
            <h2 id="controlSelectDialogLabel" class="dialog_label">Select Control to View</h2>
            <ul id="controlSelectList">
                </ul>
        </div>
    </div>

    <button id="scrollToTopBtn" title="Go to top" aria-label="Scroll to top"></button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Focusable Elements Selector ---
            const focusableElementsString = 'a[href], button:not([disabled]), textarea:not([disabled]), input:not([type="hidden"]):not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"]), [role="option"], [role="tab"], .accordion-button, #controlSelectList a';

            // --- Utility Functions ---
            const trapFocus = (element, event) => {
                const focusableEls = Array.from(element.querySelectorAll(focusableElementsString));
                const closeBtn = element.querySelector('.dialog-close-btn');
                if (closeBtn && !focusableEls.includes(closeBtn)) {
                     const firstActionBtnIndex = focusableEls.findIndex(el => el.closest('.dialog_form_actions') || el.closest('#controlSelectList'));
                     if (firstActionBtnIndex !== -1) {
                         focusableEls.splice(firstActionBtnIndex, 0, closeBtn);
                     } else {
                         focusableEls.unshift(closeBtn);
                     }
                }

                if (focusableEls.length === 0) return;

                const firstFocusableEl = focusableEls[0];
                const lastFocusableEl = focusableEls[focusableEls.length - 1];
                const isTabPressed = event.key === 'Tab';

                if (!isTabPressed) return;

                if (event.shiftKey) { // Shift + Tab
                    if (document.activeElement === firstFocusableEl) {
                        lastFocusableEl.focus();
                        event.preventDefault();
                    }
                } else { // Tab
                    if (document.activeElement === lastFocusableEl) {
                        firstFocusableEl.focus();
                        event.preventDefault();
                    }
                }
            };

            // --- Modal Dialog Logic (Generic) ---
            let focusedElementBeforeDialog;

            const openDialogGeneric = (dialogId, triggerButton) => {
                const dialogOverlay = document.getElementById(dialogId + 'Overlay');
                const dialog = document.getElementById(dialogId);

                if (!dialog || !dialogOverlay) {
                    console.error("Dialog or overlay not found for ID:", dialogId);
                    return;
                }

                focusedElementBeforeDialog = triggerButton || document.activeElement;

                dialogOverlay.classList.remove('hidden');
                dialog.classList.remove('hidden');
                document.body.classList.add('modal-open');

                let firstFocusable = dialog.querySelector('.dialog-close-btn');
                if (!firstFocusable) {
                    const focusableEls = Array.from(dialog.querySelectorAll(focusableElementsString));
                    firstFocusable = focusableEls.length > 0 ? focusableEls[0] : dialog;
                }
                 setTimeout(() => {
                     if(firstFocusable) firstFocusable.focus();
                 }, 50);

                const handleKeyDown = (event) => handleDialogKeyDownGeneric(event, dialogId);
                dialogOverlay.addEventListener('keydown', handleKeyDown);
                dialogOverlay._dialogKeyDownListener = handleKeyDown;
            };

            const closeDialogGeneric = (dialogElementOrButton) => {
                const dialog = dialogElementOrButton.closest('.dialog');
                if (!dialog) return;
                const dialogOverlay = dialog.closest('.dialog-overlay');
                if (!dialogOverlay) return;

                if (dialogOverlay._dialogKeyDownListener) {
                    dialogOverlay.removeEventListener('keydown', dialogOverlay._dialogKeyDownListener);
                    delete dialogOverlay._dialogKeyDownListener;
                }

                dialogOverlay.classList.add('hidden');
                dialog.classList.add('hidden');
                document.body.classList.remove('modal-open');

                if (focusedElementBeforeDialog) {
                    focusedElementBeforeDialog.focus();
                }
            };

             const handleDialogKeyDownGeneric = (event, dialogId) => {
                 const dialog = document.getElementById(dialogId);
                 if (!dialog) return;

                 if (event.key === 'Escape') {
                     closeDialogGeneric(dialog);
                 } else {
                     trapFocus(dialog, event);
                 }
             };

            // --- Address Modal Specific Listeners ---
            const addressDialogTrigger = document.getElementById('openDialogBtn');
            if (addressDialogTrigger) {
                addressDialogTrigger.addEventListener('click', () => {
                    openDialogGeneric('addressDialog', addressDialogTrigger);
                });
            }
             const addressDialogOverlay = document.getElementById('addressDialogOverlay');
             if (addressDialogOverlay) {
                 addressDialogOverlay.addEventListener('click', (event) => {
                     if (event.target === addressDialogOverlay) {
                         closeDialogGeneric(addressDialogOverlay.querySelector('.dialog'));
                     }
                     else if (event.target.classList.contains('dialog-close-btn')) {
                         closeDialogGeneric(event.target);
                     }
                     else if (event.target.classList.contains('dialog-cancel-btn')) {
                         closeDialogGeneric(event.target);
                     }
                     else if (event.target.classList.contains('dialog-add-btn')) {
                         console.log('Add button clicked');
                         closeDialogGeneric(event.target);
                     }
                 });
             }


            // --- Control Select Modal Logic ---
            const selectControlBtn = document.getElementById('selectControlBtn');
            const controlSelectOverlay = document.getElementById('controlSelectDialogOverlay');
            const controlSelectList = document.getElementById('controlSelectList');
            const controlSelectDialog = document.getElementById('controlSelectDialog');

            if (selectControlBtn && controlSelectOverlay && controlSelectList && controlSelectDialog) {
                selectControlBtn.addEventListener('click', () => {
                    controlSelectList.innerHTML = '';
                    const items = document.querySelectorAll('#controls-container > .form-control-item');
                    const sortedItems = Array.from(items).sort((a, b) => {
                        const titleA = a.querySelector('h2')?.textContent || '';
                        const titleB = b.querySelector('h2')?.textContent || '';
                        return titleA.localeCompare(titleB);
                    });

                    sortedItems.forEach(item => {
                        const heading = item.querySelector('h2');
                        const itemId = item.id;
                        if (heading && itemId) {
                            const li = document.createElement('li');
                            const link = document.createElement('a');
                            link.href = `#${itemId}`;
                            link.textContent = heading.textContent;
                            link.addEventListener('click', (e) => {
                                e.preventDefault();
                                const targetElement = document.getElementById(itemId);
                                closeDialogGeneric(link); // Close first
                                if (targetElement) {
                                    setTimeout(() => {
                                         targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                         targetElement.querySelector('h2')?.focus({ preventScroll: true });
                                    }, 50);
                                }
                            });
                            li.appendChild(link);
                            controlSelectList.appendChild(li);
                        }
                    });
                    openDialogGeneric('controlSelectDialog', selectControlBtn);
                });

                 controlSelectOverlay.addEventListener('click', (event) => {
                     if (event.target === controlSelectOverlay) {
                         closeDialogGeneric(controlSelectDialog);
                     } else if (event.target.classList.contains('dialog-close-btn')) {
                          closeDialogGeneric(event.target);
                     }
                 });
            }


            // --- Accordion Logic ---
            const accordions = document.querySelectorAll('.accordion');
            accordions.forEach(accordion => {
                const buttons = accordion.querySelectorAll('.accordion-button');
                buttons.forEach(button => {
                    const panelId = button.getAttribute('aria-controls');
                    const panel = document.getElementById(panelId);
                    if (!panel) {
                         console.warn(`Accordion panel with ID "${panelId}" not found for button`, button);
                         return;
                    }

                    button.addEventListener('click', () => {
                        const isExpanded = button.getAttribute('aria-expanded') === 'true';
                        button.setAttribute('aria-expanded', !isExpanded);
                        panel.classList.toggle('hidden');
                    });
                });
            });

            // --- Alert Logic ---
            const triggerAlertBtn = document.getElementById('triggerAlertBtn');
            const alertContainer = document.getElementById('alertContainer');
            if (triggerAlertBtn && alertContainer) {
                triggerAlertBtn.addEventListener('click', () => {
                    const existingAlert = alertContainer.querySelector('.alert');
                    if (existingAlert) existingAlert.remove();

                    const newAlert = document.createElement('div');
                    newAlert.className = 'alert';
                    newAlert.setAttribute('role', 'alert');
                    newAlert.textContent = `Action completed successfully at ${new Date().toLocaleTimeString()}.`;
                    alertContainer.appendChild(newAlert);
                });
            }

            // --- Carousel Logic (Basic) ---
            const carousels = document.querySelectorAll('.carousel');
            carousels.forEach(carousel => {
                const slidesContainer = carousel.querySelector('.carousel-slides');
                const slides = carousel.querySelectorAll('.carousel-slide');
                const prevButton = carousel.querySelector('.carousel-button.prev');
                const nextButton = carousel.querySelector('.carousel-button.next');
                const paginationButtons = carousel.querySelectorAll('.carousel-pagination button');
                const statusDiv = carousel.querySelector('.carousel-status');
                let currentIndex = 0;
                const totalSlides = slides.length;

                const updateCarousel = (newIndex) => {
                    if (totalSlides === 0 || !slidesContainer) return;
                    currentIndex = (newIndex + totalSlides) % totalSlides;
                    slidesContainer.style.transform = `translateX(-${currentIndex * 100}%)`;
                    paginationButtons.forEach((btn, index) => btn.setAttribute('aria-selected', index === currentIndex));
                    slides.forEach((slide, index) => slide.setAttribute('aria-label', `${index + 1} of ${totalSlides}`));
                    if (statusDiv) statusDiv.textContent = `Item ${currentIndex + 1} of ${totalSlides}`;
                };

                if (prevButton) prevButton.addEventListener('click', () => updateCarousel(currentIndex - 1));
                if (nextButton) nextButton.addEventListener('click', () => updateCarousel(currentIndex + 1));
                paginationButtons.forEach((btn, index) => btn.addEventListener('click', () => updateCarousel(index)));
                if(totalSlides > 0) updateCarousel(0);
            });


            // --- Listbox Logic (Basic Focus & Selection) ---
            const listboxes = document.querySelectorAll('[role="listbox"]');
            listboxes.forEach(listbox => {
                let options = Array.from(listbox.querySelectorAll('[role="option"]'));
                let focusedOptionIndex = -1;

                const updateFocus = (newIndex) => {
                    focusedOptionIndex = newIndex;
                    if (focusedOptionIndex >= 0 && options[focusedOptionIndex]) {
                        listbox.setAttribute('aria-activedescendant', options[focusedOptionIndex].id);
                        options[focusedOptionIndex].scrollIntoView({ block: 'nearest' });
                    } else {
                        listbox.removeAttribute('aria-activedescendant');
                    }
                };

                const selectOption = (index) => {
                    if (index < 0 || index >= options.length) return;
                    const isMultiSelect = listbox.getAttribute('aria-multiselectable') === 'true';
                    const option = options[index];
                    const isSelected = option.getAttribute('aria-selected') === 'true';
                    if (!isMultiSelect) options.forEach(opt => opt.setAttribute('aria-selected', 'false'));
                    option.setAttribute('aria-selected', isMultiSelect ? !isSelected : 'true');
                };

                listbox.addEventListener('focus', () => {
                    options = Array.from(listbox.querySelectorAll('[role="option"]')); // Refresh options on focus
                    const firstSelectedIndex = options.findIndex(opt => opt.getAttribute('aria-selected') === 'true');
                    updateFocus(firstSelectedIndex !== -1 ? firstSelectedIndex : (options.length > 0 ? 0 : -1));
                });

                listbox.addEventListener('keydown', (e) => {
                    options = Array.from(listbox.querySelectorAll('[role="option"]')); // Refresh options
                    if (options.length === 0) return;
                    let newIndex = focusedOptionIndex;
                    let preventDefault = true;

                    switch (e.key) {
                        case 'ArrowDown': newIndex = Math.min(options.length - 1, focusedOptionIndex + 1); break;
                        case 'ArrowUp': newIndex = Math.max(0, focusedOptionIndex - 1); break;
                        case 'Home': newIndex = 0; break;
                        case 'End': newIndex = options.length - 1; break;
                        case ' ': case 'Enter': selectOption(focusedOptionIndex); break;
                        default: preventDefault = false; break;
                    }

                    if (newIndex !== focusedOptionIndex && newIndex >= 0 && newIndex < options.length) {
                         updateFocus(newIndex);
                    }
                    if(preventDefault) e.preventDefault();
                });

                listbox.addEventListener('click', (e) => {
                    const clickedOption = e.target.closest('[role="option"]');
                    options = Array.from(listbox.querySelectorAll('[role="option"]')); // Refresh options
                    if (clickedOption && options.includes(clickedOption)) {
                        const index = options.indexOf(clickedOption);
                        updateFocus(index);
                        selectOption(index);
                        listbox.focus();
                    }
                });

                 // --- Rearrangeable Listbox Button Logic (Basic) ---
                 const wrapper = listbox.closest('.rearrange-listbox-wrapper');
                 if (wrapper) {
                     const moveUpBtn = wrapper.querySelector('.move-up-btn');
                     const moveDownBtn = wrapper.querySelector('.move-down-btn');

                     const moveOption = (direction) => {
                         options = Array.from(listbox.querySelectorAll('[role="option"]'));
                         if (focusedOptionIndex < 0) return;
                         const currentOption = options[focusedOptionIndex];
                         let swapIndex = -1;

                         if (direction === 'up' && focusedOptionIndex > 0) swapIndex = focusedOptionIndex - 1;
                         else if (direction === 'down' && focusedOptionIndex < options.length - 1) swapIndex = focusedOptionIndex + 1;

                         if (swapIndex !== -1) {
                             const swapOption = options[swapIndex];
                             if (direction === 'up') listbox.insertBefore(currentOption, swapOption);
                             else listbox.insertBefore(swapOption, currentOption);
                             options = Array.from(listbox.querySelectorAll('[role="option"]'));
                             updateFocus(swapIndex);
                         }
                     };

                     if (moveUpBtn) moveUpBtn.addEventListener('click', () => moveOption('up'));
                     if (moveDownBtn) moveDownBtn.addEventListener('click', () => moveOption('down'));
                 }
            });


            // --- Search/Filter Logic ---
            const searchInput = document.getElementById('controlSearchInput');
            const controlsContainer = document.getElementById('controls-container');
            const controlItems = controlsContainer ? controlsContainer.getElementsByClassName('form-control-item') : [];
            const resultsCountSpan = document.getElementById('search-results-count');
            let totalControls = controlItems.length;

            if (searchInput && controlsContainer && resultsCountSpan && controlItems.length > 0) {
                const filterControls = () => {
                    const searchTerm = searchInput.value.toLowerCase().trim();
                    let visibleCount = 0;
                    for (let item of controlItems) {
                        const title = item.querySelector('h2')?.textContent.toLowerCase() || '';
                        const keywords = item.dataset.keywords?.toLowerCase() || '';
                        const isMatch = searchTerm === '' || title.includes(searchTerm) || keywords.includes(searchTerm);
                        item.classList.toggle('hidden', !isMatch);
                        if (isMatch) visibleCount++;
                    }
                    resultsCountSpan.textContent = `${visibleCount} of ${totalControls} component${visibleCount !== 1 ? 's' : ''} shown.`;
                };
                searchInput.addEventListener('input', filterControls);
                filterControls(); // Initial run
            } else if(resultsCountSpan) {
                 resultsCountSpan.textContent = `0 components found.`;
            }

            // --- Scroll to Top Button Logic ---
            const scrollToTopBtn = document.getElementById("scrollToTopBtn");
            if (scrollToTopBtn) {
                window.onscroll = () => {
                    scrollToTopBtn.style.display = (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) ? "block" : "none";
                };
                scrollToTopBtn.addEventListener('click', () => {
                    window.scrollTo({top: 0, behavior: 'smooth'});
                    document.querySelector('h1')?.focus();
                });
            }

             // --- Theme Toggle Logic ---
             const themeToggle = document.getElementById('themeToggle');
             if (themeToggle) {
                 const applyTheme = (isDark) => {
                     document.body.classList.toggle('dark-theme', isDark);
                     themeToggle.setAttribute('aria-checked', isDark ? 'true' : 'false');
                 };
                 themeToggle.addEventListener('change', (e) => applyTheme(e.target.checked));
                 const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                 themeToggle.checked = prefersDark;
                 applyTheme(prefersDark);
             }

             // --- Toggle Switch Aria Sync ---
             const switches = document.querySelectorAll('input[role="switch"]:not(#themeToggle)');
             switches.forEach(switchInput => {
                switchInput.setAttribute('aria-checked', switchInput.checked);
                switchInput.addEventListener('change', (e) => {
                     e.target.setAttribute('aria-checked', e.target.checked);
                });
             });

             // --- Range Slider Initial Value Sync ---
             const rangeInputs = document.querySelectorAll('input[type="range"]');
             rangeInputs.forEach(rangeInput => {
                 const outputElement = document.querySelector(`output[for="${rangeInput.id}"]`);
                 if(outputElement) {
                     outputElement.textContent = rangeInput.value; // Set initial
                     rangeInput.addEventListener('input', (e) => { // Update on input
                         outputElement.textContent = e.target.value;
                     });
                 }
             });

             // --- File Input Initial Text & Update ---
             const fileInputs = document.querySelectorAll('input[type="file"]');
             fileInputs.forEach(fileInput => {
                const displaySpanId = 'fileNameDisplay' + fileInput.id.replace('InputExample','');
                const displaySpan = document.getElementById(displaySpanId);
                if(displaySpan){
                    // Set initial text
                    displaySpan.textContent = (fileInput.files && fileInput.files.length > 0) ? fileInput.files[0].name : 'No file chosen';
                    // Update on change (already handled by inline JS, but good practice to have it here too)
                    fileInput.addEventListener('change', (e) => {
                         displaySpan.textContent = (e.target.files.length > 0) ? e.target.files[0].name : 'No file chosen';
                    });
                }
             });

        }); // End DOMContentLoaded
    </script>

</body>
</html>
